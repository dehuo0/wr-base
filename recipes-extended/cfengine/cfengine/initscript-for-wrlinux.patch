Upstream-Status: Inappropriate [WLinux patch]

Add WRLinux support in cfengine3 init script.

Signed-off-by: Kai Kang <kai.kang@windriver.com>
---
diff --git a/misc/init.d/cfengine3.in b/misc/init.d/cfengine3.in
index cbb5b03..8d7c442 100644
--- a/misc/init.d/cfengine3.in
+++ b/misc/init.d/cfengine3.in
@@ -55,6 +55,7 @@ test -f $CFEXECD || exit 0
 SUSE=0
 REDHAT=0
 DEBIAN=0
+WRLINUX=1
 
 # SuSE
 if [ -d /var/lock/subsys ] && [ -f /usr/bin/zypper ]; then
@@ -158,12 +159,12 @@ case "$1" in
 
         # start cf-execd
         # Redhat/Centos/Fedora
-        if [ "$RUN_CF_EXECD" = "1" ] && [ "$REDHAT" = "1" ] && [ "$FUNC" = "1" ]; then
+        if [ "$RUN_CF_EXECD" = "1" ] && [ "$REDHAT" = "1" -o "$WRLINUX" = "1" ] && [ "$FUNC" = "1" ]; then
             $ECHO -n "Starting `basename $CFEXECD`: "
             daemon $CFEXECD
             $TOUCH /var/lock/subsys/`basename $CFEXECD`
             $ECHO
-        elif [ "$RUN_CF_EXECD" = "1" ] && [ "$REDHAT" = "1" ] && [ "$FUNC" = "0" ]; then
+        elif [ "$RUN_CF_EXECD" = "1" ] && [ "$REDHAT" = "1" -o "$WRLINUX" = "1" ] && [ "$FUNC" = "0" ]; then
             $ECHO -n "Starting `basename $CFEXECD`: "
             $CFEXECD
             $TOUCH /var/lock/subsys/`basename $CFEXECD`
@@ -194,12 +195,12 @@ case "$1" in
         
         # start cf-serverd
         # Redhat/Centos/Fedora
-        if [ "$RUN_CF_SERVERD" = "1" ] && [ "$REDHAT" = "1" ] && [ "$FUNC" = "1" ]; then
+        if [ "$RUN_CF_SERVERD" = "1" ] && [ "$REDHAT" = "1" -o "$WRLINUX" = "1" ] && [ "$FUNC" = "1" ]; then
             $ECHO -n "Starting `basename $CFSERVD`: "
             daemon $CFSERVD
             $TOUCH /var/lock/subsys/`basename $CFSERVD`
             $ECHO
-        elif [ "$RUN_CF_SERVERD" = "1" ] && [ "$REDHAT" = "1" ] && [ "$FUNC" = "0" ]; then
+        elif [ "$RUN_CF_SERVERD" = "1" ] && [ "$REDHAT" = "1" -o "$WRLINUX" = "1" ] && [ "$FUNC" = "0" ]; then
             $ECHO -n "Starting `basename $CFSERVD`: "
             $CFSERVD
             $TOUCH /var/lock/subsys/`basename $CFSERVD`
@@ -230,12 +231,12 @@ case "$1" in
         
         # start cf-monitord
         # Redhat/Centos/Fedora
-        if [ "$RUN_CF_MONITORD" = "1" ] && [ "$REDHAT" = "1" ] && [ "$FUNC" = "1" ]; then
+        if [ "$RUN_CF_MONITORD" = "1" ] && [ "$REDHAT" = "1" -o "$WRLINUX" = "1" ] && [ "$FUNC" = "1" ]; then
             $ECHO -n "Starting `basename $CFMOND`: "
             daemon $CFMOND
             $TOUCH /var/lock/subsys/`basename $CFMOND`
             $ECHO
-        elif [ "$RUN_CF_MONITORD" = "1" ] && [ "$REDHAT" = "1" ] && [ "$FUNC" = "0" ]; then
+        elif [ "$RUN_CF_MONITORD" = "1" ] && [ "$REDHAT" = "1" -o "$WRLINUX" = "1" ] && [ "$FUNC" = "0" ]; then
             $ECHO -n "Starting `basename $CFMOND`: "
             $CFMOND
             $TOUCH /var/lock/subsys/`basename $CFMOND`
@@ -269,14 +270,14 @@ case "$1" in
         if [ "$CF_ONLY_WEB_SERVICES" != "1" ]; then
             # shutdown cf-execd
             # Redhat/Centos/Fedora
-            if [ "$RUN_CF_EXECD" = "1" ] && [ "$REDHAT" = "1" ] && [ "$FUNC" = "1" ]; then
+            if [ "$RUN_CF_EXECD" = "1" ] && [ "$REDHAT" = "1" -o "$WRLINUX" = "1" ] && [ "$FUNC" = "1" ]; then
                 $ECHO -n "Shutting down `basename $CFEXECD`: "
                 killproc $CFEXECD || :
                 if [ -f /var/lock/subsys/`basename $CFEXECD` ]; then
                     $RM -f /var/lock/subsys/`basename $CFEXECD` || true
                 fi
                 $ECHO
-            elif [ "$RUN_CF_EXECD" = "1" ] && [ "$REDHAT" = "1" ] && [ "$FUNC" = "0" ]; then
+            elif [ "$RUN_CF_EXECD" = "1" ] && [ "$REDHAT" = "1" -o "$WRLINUX" = "1" ] && [ "$FUNC" = "0" ]; then
                 $ECHO -n "Shutting down `basename $CFEXECD`: "
                 $PKILL `basename $CFEXECD` || :
                 if [ -f /var/lock/subsys/`basename $CFEXECD` ]; then
@@ -324,14 +325,14 @@ case "$1" in
             
             # shutdown cf-serverd
             # Redhat/Centos/Fedora
-            if [ "$RUN_CF_SERVERD" = "1" ] && [ "$REDHAT" = "1" ] && [ "$FUNC" = "1" ]; then
+            if [ "$RUN_CF_SERVERD" = "1" ] && [ "$REDHAT" = "1" -o "$WRLINUX" = "1" ] && [ "$FUNC" = "1" ]; then
                 $ECHO -n "Shutting down `basename $CFSERVD`: "
                 killproc $CFSERVD || :
                 if [ -f /var/lock/subsys/`basename $CFSERVD` ]; then
                     $RM -f /var/lock/subsys/`basename $CFSERVD` || true
                 fi
                 $ECHO
-            elif [ "$RUN_CF_SERVERD" = "1" ] && [ "$REDHAT" = "1" ] && [ "$FUNC" = "0" ]; then
+            elif [ "$RUN_CF_SERVERD" = "1" ] && [ "$REDHAT" = "1" -o "$WRLINUX" = "1" ] && [ "$FUNC" = "0" ]; then
                 $ECHO -n "Shutting down `basename $CFSERVD`: "
                 $PKILL `basename $CFSERVD` || :
                 if [ -f /var/lock/subsys/`basename $CFSERVD` ]; then
@@ -379,14 +380,14 @@ case "$1" in
             
             # shutdown cf-monitord
             # Redhat/Centos/Fedora
-            if [ "$RUN_CF_MONITORD" = "1" ] && [ "$REDHAT" = "1" ] && [ "$FUNC" = "1" ]; then
+            if [ "$RUN_CF_MONITORD" = "1" ] && [ "$REDHAT" = "1" -o "$WRLINUX" = "1" ] && [ "$FUNC" = "1" ]; then
                 $ECHO -n "Shutting down `basename $CFMOND`: "
                 killproc $CFMOND || :
                 if [ -f /var/lock/subsys/`basename $CFMOND` ]; then
                     $RM -f /var/lock/subsys/`basename $CFMOND` || true
                 fi
                 $ECHO
-            elif [ "$RUN_CF_MONITORD" = "1" ] && [ "$REDHAT" = "1" ] && [ "$FUNC" = "0" ]; then
+            elif [ "$RUN_CF_MONITORD" = "1" ] && [ "$REDHAT" = "1" -o "$WRLINUX" = "1" ] && [ "$FUNC" = "0" ]; then
                 $ECHO -n "Shutting down `basename $CFMOND`: "
                 $PKILL `basename $CFMOND` || :
                 if [ -f /var/lock/subsys/`basename $CFMOND` ]; then
@@ -448,9 +449,9 @@ case "$1" in
 
         # status cf-execd
         # Redhat/Centos/Fedora
-        if [ "$REDHAT" = "1" ] && [ "$FUNC" = "1" ]; then
+        if [ "$REDHAT" = "1" -o "$WRLINUX" = "1" ] && [ "$FUNC" = "1" ]; then
             status $CFEXECD
-        elif [ "$REDHAT" = "1" ] && [ "$FUNC" = "0" ]; then
+        elif [ "$REDHAT" = "1" -o "$WRLINUX" = "1" ] && [ "$FUNC" = "0" ]; then
             if [ $cfexecd_status ]; then
                 $ECHO "cf-execd (pid $cfexecd_status) is running..."
             else 
@@ -476,9 +477,9 @@ case "$1" in
         
         # status cf-serverd
         # Redhat/Centos/Fedora
-        if [ "$REDHAT" = "1" ] && [ "$FUNC" = "1" ]; then
+        if [ "$REDHAT" = "1" -o "$WRLINUX" = "1" ] && [ "$FUNC" = "1" ]; then
             status $CFSERVD
-        elif [ "$REDHAT" = "1" ] && [ "$FUNC" = "0" ]; then
+        elif [ "$REDHAT" = "1" -o "$WRLINUX" = "1" ] && [ "$FUNC" = "0" ]; then
             if [ $cfserverd_status ]; then
                 $ECHO "cf-serverd (pid $cfserverd_status) is running..."
             else
@@ -504,9 +505,9 @@ case "$1" in
         
         # status cf-monitord
         # Redhat/Centos/Fedora
-        if [ "$REDHAT" = "1" ] && [ "$FUNC" = "1" ]; then
+        if [ "$REDHAT" = "1" -o "$WRLINUX" = "1" ] && [ "$FUNC" = "1" ]; then
             status $CFMOND
-        elif [ "$REDHAT" = "1" ] && [ "$FUNC" = "0" ]; then
+        elif [ "$REDHAT" = "1" -o "$WRLINUX" = "1" ] && [ "$FUNC" = "0" ]; then
             if [ $cfmonitord_status ]; then
                 $ECHO "cf-monitord (pid $cfmonitord_status) is running..."
             else
