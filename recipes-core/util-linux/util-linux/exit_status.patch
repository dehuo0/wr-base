exit_status

Signed-off-by: Jason Wessel <jason.wessel@windriver.com>
Signed-off-by: Mark Hatle <mark.hatle@windriver.com>
Signed-off-by: Chong Lu <Chong.Lu@windriver.com>
---
 term-utils/script.c |   15 ++++++++++-----
 1 file changed, 10 insertions(+), 5 deletions(-)

diff --git a/term-utils/script.c b/term-utils/script.c
index 89eee94..6bc91e4 100644
--- a/term-utils/script.c
+++ b/term-utils/script.c
@@ -111,6 +111,7 @@ int	forceflg = 0;
 
 int die;
 int resized;
+int childstatus;
 
 static void
 die_if_link(char *fn) {
@@ -330,11 +331,11 @@ finish(int dummy __attribute__ ((__unused__))) {
 	pid_t pid;
 	int errsv = errno;
 
-	while ((pid = wait3(&status, WNOHANG, 0)) > 0)
-		if (pid == child) {
-			childstatus = status;
+	while ((pid = waitpid(-1, &status, WNOHANG)) > 0) {
+		if (pid == child)
 			die = 1;
-		}
+		childstatus = status;
+	}
 
 	errno = errsv;
 }
@@ -512,7 +513,11 @@ done(void) {
 		else
 			exit(WEXITSTATUS(childstatus));
 	}
-	exit(EXIT_SUCCESS);
+
+	if (childstatus < 256 && childstatus > 0)
+		exit(childstatus);
+
+	exit(childstatus>>8);
 }
 
 void
-- 
1.7.9.5

