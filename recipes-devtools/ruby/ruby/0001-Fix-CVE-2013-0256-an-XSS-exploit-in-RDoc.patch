From ffa87887ee0517793df7541629a470e331f9fe60 Mon Sep 17 00:00:00 2001
From: Eric Hodel <drbrain@segment7.net>
Date: Tue, 5 Feb 2013 19:57:58 -0800
Subject: [PATCH] Fix CVE-2013-0256, an XSS exploit in RDoc

commit ffa87887ee0517793df7541629a470e331f9fe60 upstream

See CVE-2013-0256 for details on the exploit including a patch you can
apply to generated RDoc output.
---
 .../generator/template/darkfish/js/darkfish.js     |   16 ++++---
 6 files changed, 65 insertions(+), 9 deletions(-)
 create mode 100644 CVE-2013-0256.rdoc

diff --git a/lib/rdoc/generator/template/darkfish/js/darkfish.js b/lib/rdoc/generator/template/darkfish/js/darkfish.js
index 4be722f..f26fd45 100644
--- a/lib/rdoc/generator/template/darkfish/js/darkfish.js
+++ b/lib/rdoc/generator/template/darkfish/js/darkfish.js
@@ -73,13 +73,15 @@ function hookQuickSearch() {
 function highlightTarget( anchor ) {
 	console.debug( "Highlighting target '%s'.", anchor );
 
-	$("a[name=" + anchor + "]").each( function() {
-		if ( !$(this).parent().parent().hasClass('target-section') ) {
-			console.debug( "Wrapping the target-section" );
-			$('div.method-detail').unwrap( 'div.target-section' );
-			$(this).parent().wrap( '<div class="target-section"></div>' );
-		} else {
-			console.debug( "Already wrapped." );
+	$("a[name]").each( function() {
+		if ( $(this).attr("name") == anchor ) {
+			if ( !$(this).parent().parent().hasClass('target-section') ) {
+				console.debug( "Wrapping the target-section" );
+				$('div.method-detail').unwrap( 'div.target-section' );
+				$(this).parent().wrap( '<div class="target-section"></div>' );
+			} else {
+				console.debug( "Already wrapped." );
+			}
 		}
 	});
 };
-- 
1.7.5.4

